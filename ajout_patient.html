<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gestion Urgences - Patients</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
<div class="container mt-5">
    <h1>Liste des Patients</h1>
    <ul id="patientsList" class="list-group mb-4"></ul>

    <h2>Ajouter un Patient</h2>
    <form id="patientForm">
        <div class="mb-3">
            <label for="nom" class="form-label">Nom</label>
            <input type="text" class="form-control" id="nom" required />
        </div>
        <div class="mb-3">
            <label for="prenom" class="form-label">Prénom</label>
            <input type="text" class="form-control" id="prenom" required />
        </div>
        <div class="mb-3">
            <label for="date_naissance" class="form-label">Date de naissance</label>
            <input type="date" class="form-control" id="date_naissance" required />
        </div>
        <div class="mb-3">
            <label for="sexe" class="form-label">Sexe</label>
            <select class="form-select" id="sexe" required>
                <option value="">Choisir...</option>
                <option value="M">Masculin</option>
                <option value="F">Féminin</option>
                <option value="Autre">Autre</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="mode_arrivee" class="form-label">Mode d’arrivée</label>
            <select class="form-select" id="mode_arrivee" required>
                <option value="">Choisir...</option>
                <option value="seul">Seul</option>
                <option value="ambulance">Ambulance</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Ajouter</button>
    </form>

    <div id="message" class="mt-3"></div>
</div>

<script>
    const apiUrl = 'http://localhost:5000/patients';

    // Affiche la liste des patients
    function fetchPatients() {
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('patientsList');
                list.innerHTML = '';
                data.forEach(patient => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.textContent = `${patient.nom} ${patient.prenom} - Né(e) le ${patient.date_naissance} - Sexe : ${patient.sexe} - Arrivé(e) : ${patient.mode_arrivee}`;
                    list.appendChild(li);
                });
            });
    }

    // Envoi du formulaire pour ajouter un patient
    document.getElementById('patientForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const patientData = {
            nom: document.getElementById('nom').value,
            prenom: document.getElementById('prenom').value,
            date_naissance: document.getElementById('date_naissance').value,
            sexe: document.getElementById('sexe').value,
            mode_arrivee: document.getElementById('mode_arrivee').value,
        };

        fetch(apiUrl, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(patientData)
        })
            .then(response => {
                if (response.ok) {
                    document.getElementById('message').innerHTML = '<div class="alert alert-success">Patient ajouté avec succès !</div>';
                    this.reset();
                    fetchPatients();
                } else {
                    response.json().then(data => {
                        document.getElementById('message').innerHTML = `<div class="alert alert-danger">Erreur: ${data.error}</div>`;
                    });
                }
            })
            .catch(() => {
                document.getElementById('message').innerHTML = '<div class="alert alert-danger">Erreur réseau</div>';
            });
    });

    // Charger la liste au chargement de la page
    window.onload = fetchPatients;
</script>

</body>
</html>
